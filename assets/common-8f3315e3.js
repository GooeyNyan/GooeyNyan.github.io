import{a as G}from"./actionName-f5726d88.js";import{k as S}from"./keigenns-316524d1.js";import{g as le,a as ce}from"./status-112fc016.js";let J=!1,W=null,A=null,F=[],de=0;const $={},h={},k=(e,t)=>{A?F?F.push(e):A.send(JSON.stringify(e)):F?F.push([e,t]):window.OverlayPluginApi.callHandler(JSON.stringify(e),t)},j=e=>{x();const t=h[e.type];t==null||t.forEach(a=>{try{a(e)}catch(n){console.error(n)}})},pe=j,ue=(e,t)=>{var a;x(),h[e]||(h[e]=[],F||k({call:"subscribe",events:[e]})),(a=h[e])==null||a.push(t)},me=(e,t)=>{if(x(),h[e]){const a=h[e],n=a==null?void 0:a.indexOf(t);n!==void 0&&n>-1&&(a==null||a.splice(n,1))}},ye=e=>{x();const t={...e,rseq:0};let a;return A?(t.rseq=de++,a=new Promise((n,s)=>{$[t.rseq]={resolve:n,reject:s}}),k(t)):a=new Promise((n,s)=>{k(t,i=>{if(i===null){n(i);return}const l=JSON.parse(i);l.$error?s(l):n(l)})}),a},fe={},K=e=>{x();const t=e.call;return(fe[t]??ye)(e)},x=()=>{if(!J){if(typeof window<"u"){if(W=new URLSearchParams(window.location.search).get("OVERLAY_WS"),W!==null){const e=function(t){A=new WebSocket(t),A.addEventListener("error",a=>{console.error(a)}),A.addEventListener("open",()=>{console.log("Connected!");const a=F??[];F=null,k({call:"subscribe",events:Object.keys(h)});for(const n of a)Array.isArray(n)||k(n)}),A.addEventListener("message",a=>{try{if(typeof a.data!="string"){console.error("Invalid message data received: ",a);return}const n=JSON.parse(a.data),s=(n==null?void 0:n.rseq)!==void 0?$[n.rseq]:void 0;n.rseq!==void 0&&s?(n.$error?s.reject(n):s.resolve(n),delete $[n.rseq]):j(n)}catch{console.error("Invalid message received: ",a);return}}),A.addEventListener("close",()=>{F=null,console.log("Trying to reconnect..."),window.setTimeout(()=>{e(t)},300)})};e(W)}else{const e=function(){var a;if(!((a=window.OverlayPluginApi)!=null&&a.ready)){window.setTimeout(e,300);return}const t=F??[];F=null,window.__OverlayCallback=j,k({call:"subscribe",events:Object.keys(h)});for(const n of t)Array.isArray(n)&&k(n[0],n[1])};e()}window.addOverlayListener=ue,window.removeOverlayListener=me,window.callOverlayHandler=K,window.dispatchOverlayEvent=pe}J=!0}};var Y=(e=>(e[e.JobName=1]="JobName",e[e.JobIcon=2]="JobIcon",e[e.JobIconV2=3]="JobIconV2",e[e.JobIconV3=4]="JobIconV3",e))(Y||{}),q=(e=>(e[e.Yes=1]="Yes",e[e.No=2]="No",e))(q||{});const pt=28,ut="your_keigenn_record_config",mt={targetType:Y.JobIconV2,showTargetName:q.No,showDotDamage:q.No,fontSize:12,opacity:45,durationWidth:40,abilityWidth:90,targetWidth:60,damageWidth:80,mutationWidth:50},ge=["CurrentWorldID","WorldID","WorldName","BNpcID","BNpcNameID","PartyType","ID","OwnerID","WeaponId","Type","Job","Level","Name","CurrentHP","MaxHP","CurrentMP","MaxMP","PosX","PosY","PosZ","Heading","MonsterType","Status","ModelStatus","AggressionStatus","TargetID","IsTargetable","Radius","Distance","EffectiveDistance","NPCTargetID","CurrentGP","MaxGP","CurrentCP","MaxCP","PCTargetID","IsCasting1","IsCasting2","CastBuffID","CastTargetID","CastDurationCurrent","CastDurationMax","TransformationId"],Ie={GameLog:{type:"00",name:"GameLog",source:"FFXIV_ACT_Plugin",messageType:"ChatLog",fields:{type:0,timestamp:1,code:2,name:3,line:4},subFields:{code:{"0039":{name:"message",canAnonymize:!0},"0038":{name:"echo",canAnonymize:!0},"0044":{name:"dialog",canAnonymize:!0},"0839":{name:"message",canAnonymize:!0}}},firstOptionalField:void 0},ChangeZone:{type:"01",name:"ChangeZone",source:"FFXIV_ACT_Plugin",messageType:"Territory",fields:{type:0,timestamp:1,id:2,name:3},lastInclude:!0,canAnonymize:!0,firstOptionalField:void 0},ChangedPlayer:{type:"02",name:"ChangedPlayer",source:"FFXIV_ACT_Plugin",messageType:"ChangePrimaryPlayer",fields:{type:0,timestamp:1,id:2,name:3},playerIds:{2:3},lastInclude:!0,canAnonymize:!0,firstOptionalField:void 0},AddedCombatant:{type:"03",name:"AddedCombatant",source:"FFXIV_ACT_Plugin",messageType:"AddCombatant",fields:{type:0,timestamp:1,id:2,name:3,job:4,level:5,ownerId:6,worldId:7,world:8,npcNameId:9,npcBaseId:10,currentHp:11,hp:12,currentMp:13,mp:14,x:17,y:18,z:19,heading:20},playerIds:{2:3,6:null},canAnonymize:!0,firstOptionalField:void 0},RemovedCombatant:{type:"04",name:"RemovedCombatant",source:"FFXIV_ACT_Plugin",messageType:"RemoveCombatant",fields:{type:0,timestamp:1,id:2,name:3,job:4,level:5,owner:6,world:8,npcNameId:9,npcBaseId:10,hp:12,x:17,y:18,z:19,heading:20},playerIds:{2:3,6:null},canAnonymize:!0,firstOptionalField:void 0},PartyList:{type:"11",name:"PartyList",source:"FFXIV_ACT_Plugin",messageType:"PartyList",fields:{type:0,timestamp:1,partyCount:2,id0:3,id1:4,id2:5,id3:6,id4:7,id5:8,id6:9,id7:10,id8:11,id9:12,id10:13,id11:14,id12:15,id13:16,id14:17,id15:18,id16:19,id17:20,id18:21,id19:22,id20:23,id21:24,id22:25,id23:26},playerIds:{3:null,4:null,5:null,6:null,7:null,8:null,9:null,10:null,11:null,12:null,13:null,14:null,15:null,16:null,17:null,18:null,19:null,20:null,21:null,22:null,23:null,24:null,25:null,26:null},firstOptionalField:3,canAnonymize:!0,lastInclude:!0},PlayerStats:{type:"12",name:"PlayerStats",source:"FFXIV_ACT_Plugin",messageType:"PlayerStats",fields:{type:0,timestamp:1,job:2,strength:3,dexterity:4,vitality:5,intelligence:6,mind:7,piety:8,attackPower:9,directHit:10,criticalHit:11,attackMagicPotency:12,healMagicPotency:13,determination:14,skillSpeed:15,spellSpeed:16,tenacity:18,localContentId:19},canAnonymize:!0,lastInclude:!0,firstOptionalField:void 0},StartsUsing:{type:"20",name:"StartsUsing",source:"FFXIV_ACT_Plugin",messageType:"StartsCasting",fields:{type:0,timestamp:1,sourceId:2,source:3,id:4,ability:5,targetId:6,target:7,castTime:8,x:9,y:10,z:11,heading:12},possibleRsvFields:[5],blankFields:[6],playerIds:{2:3,6:7},canAnonymize:!0,firstOptionalField:void 0},Ability:{type:"21",name:"Ability",source:"FFXIV_ACT_Plugin",messageType:"ActionEffect",fields:{type:0,timestamp:1,sourceId:2,source:3,id:4,ability:5,targetId:6,target:7,flags:8,damage:9,targetCurrentHp:24,targetMaxHp:25,targetCurrentMp:26,targetMaxMp:27,targetX:30,targetY:31,targetZ:32,targetHeading:33,currentHp:34,maxHp:35,currentMp:36,maxMp:37,x:40,y:41,z:42,heading:43,sequence:44,targetIndex:45,targetCount:46},possibleRsvFields:[5],playerIds:{2:3,6:7},blankFields:[6],canAnonymize:!0,firstOptionalField:void 0},NetworkAOEAbility:{type:"22",name:"NetworkAOEAbility",source:"FFXIV_ACT_Plugin",messageType:"AOEActionEffect",fields:{type:0,timestamp:1,sourceId:2,source:3,id:4,ability:5,targetId:6,target:7,flags:8,damage:9,targetCurrentHp:24,targetMaxHp:25,targetCurrentMp:26,targetMaxMp:27,targetX:30,targetY:31,targetZ:32,targetHeading:33,currentHp:34,maxHp:35,currentMp:36,maxMp:37,x:40,y:41,z:42,heading:43,sequence:44,targetIndex:45,targetCount:46},possibleRsvFields:[5],playerIds:{2:3,6:7},blankFields:[6],canAnonymize:!0,firstOptionalField:void 0},NetworkCancelAbility:{type:"23",name:"NetworkCancelAbility",source:"FFXIV_ACT_Plugin",messageType:"CancelAction",fields:{type:0,timestamp:1,sourceId:2,source:3,id:4,name:5,reason:6},possibleRsvFields:[5],playerIds:{2:3},canAnonymize:!0,firstOptionalField:void 0},NetworkDoT:{type:"24",name:"NetworkDoT",source:"FFXIV_ACT_Plugin",messageType:"DoTHoT",fields:{type:0,timestamp:1,id:2,name:3,which:4,effectId:5,damage:6,currentHp:7,maxHp:8,currentMp:9,maxMp:10,x:13,y:14,z:15,heading:16,sourceId:17,source:18,damageType:19,sourceCurrentHp:20,sourceMaxHp:21,sourceCurrentMp:22,sourceMaxMp:23,sourceX:26,sourceY:27,sourceZ:28,sourceHeading:29},playerIds:{2:3,17:18},canAnonymize:!0,firstOptionalField:void 0},WasDefeated:{type:"25",name:"WasDefeated",source:"FFXIV_ACT_Plugin",messageType:"Death",fields:{type:0,timestamp:1,targetId:2,target:3,sourceId:4,source:5},playerIds:{2:3,4:5},canAnonymize:!0,firstOptionalField:void 0},GainsEffect:{type:"26",name:"GainsEffect",source:"FFXIV_ACT_Plugin",messageType:"StatusAdd",fields:{type:0,timestamp:1,effectId:2,effect:3,duration:4,sourceId:5,source:6,targetId:7,target:8,count:9,targetMaxHp:10,sourceMaxHp:11},possibleRsvFields:[3],playerIds:{5:6,7:8},canAnonymize:!0,firstOptionalField:void 0},HeadMarker:{type:"27",name:"HeadMarker",source:"FFXIV_ACT_Plugin",messageType:"TargetIcon",fields:{type:0,timestamp:1,targetId:2,target:3,id:6},playerIds:{2:3},canAnonymize:!0,firstOptionalField:void 0},NetworkRaidMarker:{type:"28",name:"NetworkRaidMarker",source:"FFXIV_ACT_Plugin",messageType:"WaymarkMarker",fields:{type:0,timestamp:1,operation:2,waymark:3,id:4,name:5,x:6,y:7,z:8},canAnonymize:!0,firstOptionalField:void 0},NetworkTargetMarker:{type:"29",name:"NetworkTargetMarker",source:"FFXIV_ACT_Plugin",messageType:"SignMarker",fields:{type:0,timestamp:1,operation:2,waymark:3,id:4,name:5,targetId:6,targetName:7},playerIds:{4:null,5:null},firstOptionalField:void 0},LosesEffect:{type:"30",name:"LosesEffect",source:"FFXIV_ACT_Plugin",messageType:"StatusRemove",fields:{type:0,timestamp:1,effectId:2,effect:3,sourceId:5,source:6,targetId:7,target:8,count:9},possibleRsvFields:[3],playerIds:{5:6,7:8},canAnonymize:!0,firstOptionalField:void 0},NetworkGauge:{type:"31",name:"NetworkGauge",source:"FFXIV_ACT_Plugin",messageType:"Gauge",fields:{type:0,timestamp:1,id:2,data0:3,data1:4,data2:5,data3:6},playerIds:{2:null},firstUnknownField:3,canAnonymize:!0,firstOptionalField:void 0},NetworkWorld:{type:"32",name:"NetworkWorld",source:"FFXIV_ACT_Plugin",messageType:"World",fields:{type:0,timestamp:1},isUnknown:!0,firstOptionalField:void 0},ActorControl:{type:"33",name:"ActorControl",source:"FFXIV_ACT_Plugin",messageType:"Director",fields:{type:0,timestamp:1,instance:2,command:3,data0:4,data1:5,data2:6,data3:7},canAnonymize:!0,firstOptionalField:void 0},NameToggle:{type:"34",name:"NameToggle",source:"FFXIV_ACT_Plugin",messageType:"NameToggle",fields:{type:0,timestamp:1,id:2,name:3,targetId:4,targetName:5,toggle:6},playerIds:{2:3,4:5},canAnonymize:!0,firstOptionalField:void 0},Tether:{type:"35",name:"Tether",source:"FFXIV_ACT_Plugin",messageType:"Tether",fields:{type:0,timestamp:1,sourceId:2,source:3,targetId:4,target:5,id:8},playerIds:{2:3,4:5},canAnonymize:!0,firstUnknownField:9,firstOptionalField:void 0},LimitBreak:{type:"36",name:"LimitBreak",source:"FFXIV_ACT_Plugin",messageType:"LimitBreak",fields:{type:0,timestamp:1,valueHex:2,bars:3},canAnonymize:!0,firstOptionalField:void 0},NetworkEffectResult:{type:"37",name:"NetworkEffectResult",source:"FFXIV_ACT_Plugin",messageType:"EffectResult",fields:{type:0,timestamp:1,id:2,name:3,sequenceId:4,currentHp:5,maxHp:6,currentMp:7,maxMp:8,x:11,y:12,z:13,heading:14},playerIds:{2:3},firstUnknownField:22,canAnonymize:!0,firstOptionalField:void 0},StatusEffect:{type:"38",name:"StatusEffect",source:"FFXIV_ACT_Plugin",messageType:"StatusList",fields:{type:0,timestamp:1,targetId:2,target:3,jobLevelData:4,hp:5,maxHp:6,mp:7,maxMp:8,x:11,y:12,z:13,heading:14,data0:15,data1:16,data2:17,data3:18,data4:19,data5:20},playerIds:{2:3},firstUnknownField:18,canAnonymize:!0,firstOptionalField:18},NetworkUpdateHP:{type:"39",name:"NetworkUpdateHP",source:"FFXIV_ACT_Plugin",messageType:"UpdateHp",fields:{type:0,timestamp:1,id:2,name:3,currentHp:4,maxHp:5,currentMp:6,maxMp:7,x:10,y:11,z:12,heading:13},playerIds:{2:3},canAnonymize:!0,firstOptionalField:void 0},Map:{type:"40",name:"Map",source:"FFXIV_ACT_Plugin",messageType:"ChangeMap",fields:{type:0,timestamp:1,id:2,regionName:3,placeName:4,placeNameSub:5},canAnonymize:!0,firstOptionalField:void 0,lastInclude:!0},SystemLogMessage:{type:"41",name:"SystemLogMessage",source:"FFXIV_ACT_Plugin",messageType:"SystemLogMessage",fields:{type:0,timestamp:1,instance:2,id:3,param0:4,param1:5,param2:6},canAnonymize:!0,firstOptionalField:void 0},StatusList3:{type:"42",name:"StatusList3",source:"FFXIV_ACT_Plugin",messageType:"StatusList3",fields:{type:0,timestamp:1,id:2,name:3},playerIds:{2:3},canAnonymize:!0,firstOptionalField:4,firstUnknownField:4},ParserInfo:{type:"249",name:"ParserInfo",source:"FFXIV_ACT_Plugin",messageType:"Settings",fields:{type:0,timestamp:1},globalInclude:!0,canAnonymize:!0,firstOptionalField:void 0},ProcessInfo:{type:"250",name:"ProcessInfo",source:"FFXIV_ACT_Plugin",messageType:"Process",fields:{type:0,timestamp:1},globalInclude:!0,canAnonymize:!0,firstOptionalField:void 0},Debug:{type:"251",name:"Debug",source:"FFXIV_ACT_Plugin",messageType:"Debug",fields:{type:0,timestamp:1},globalInclude:!0,canAnonymize:!1,firstOptionalField:void 0},PacketDump:{type:"252",name:"PacketDump",source:"FFXIV_ACT_Plugin",messageType:"PacketDump",fields:{type:0,timestamp:1},canAnonymize:!1,firstOptionalField:void 0},Version:{type:"253",name:"Version",source:"FFXIV_ACT_Plugin",messageType:"Version",fields:{type:0,timestamp:1},globalInclude:!0,canAnonymize:!0,firstOptionalField:void 0},Error:{type:"254",name:"Error",source:"FFXIV_ACT_Plugin",messageType:"Error",fields:{type:0,timestamp:1},canAnonymize:!1,firstOptionalField:void 0},None:{type:"[0-9]+",name:"None",source:"FFXIV_ACT_Plugin",messageType:"None",fields:{type:0,timestamp:1},isUnknown:!0,firstOptionalField:void 0},LineRegistration:{type:"256",name:"LineRegistration",source:"OverlayPlugin",messageType:"256",fields:{type:0,timestamp:1,id:2,source:3,version:4},globalInclude:!0,canAnonymize:!0,firstOptionalField:void 0},MapEffect:{type:"257",name:"MapEffect",source:"OverlayPlugin",messageType:"257",fields:{type:0,timestamp:1,instance:2,flags:3,location:4,data0:5,data1:6},canAnonymize:!0,firstOptionalField:void 0},FateDirector:{type:"258",name:"FateDirector",source:"OverlayPlugin",messageType:"258",fields:{type:0,timestamp:1,category:2,fateId:4,progress:5},canAnonymize:!0,firstOptionalField:void 0},CEDirector:{type:"259",name:"CEDirector",source:"OverlayPlugin",messageType:"259",fields:{type:0,timestamp:1,popTime:2,timeRemaining:3,ceKey:5,numPlayers:6,status:7,progress:9},canAnonymize:!0,firstOptionalField:void 0},InCombat:{type:"260",name:"InCombat",source:"OverlayPlugin",messageType:"260",fields:{type:0,timestamp:1,inACTCombat:2,inGameCombat:3},canAnonymize:!0,firstOptionalField:void 0},CombatantMemory:{type:"261",name:"CombatantMemory",source:"OverlayPlugin",messageType:"261",fields:{type:0,timestamp:1,change:2,id:3},canAnonymize:!0,firstOptionalField:5,firstUnknownField:4,playerIds:{3:null},repeatingFields:{startingIndex:4,label:"pair",names:["key","value"],sortKeys:!0,primaryKey:"key",possibleKeys:ge}},RSVData:{type:"262",name:"RSVData",source:"OverlayPlugin",messageType:"262",fields:{type:0,timestamp:1,locale:2,key:4,value:5},canAnonymize:!0,firstOptionalField:void 0}},Fe={latest:Ie},m=Fe.latest,Ce=["3E","113","213","313"],be="36",ve=["01","03","05","06",be],Ae=["04"],he=e=>{if(e===void 0)return 0;const t=e.length;if(t<=4)return 0;let a=parseInt(e.slice(0,t-4),16);if(e[t-4]==="4"){const n=parseInt(e.slice(t-2,t),16);a=a-n+(n<<16)}return a},Te=e=>{const t=m.Ability.fields.flags;let a=e[t]??"",n=e[t+1]??"";Ce.includes(a)&&(a=e[t+2]??a,n=e[t+3]??n);const s=he(n),i=`00${a}`.slice(-2);return{amount:s,lowByte:i,flags:a,isHeal:Ae.includes(i),isAttack:ve.includes(i)}};var N=(e=>(e[e.Ability=1]="Ability",e[e.DoT=2]="DoT",e[e.Defeated=3]="Defeated",e[e.Wipe=4]="Wipe",e))(N||{}),o=(e=>(e[e.Physics=1]="Physics",e[e.Magic=2]="Magic",e[e.Darkness=3]="Darkness",e[e.Dodge=4]="Dodge",e[e.Death=5]="Death",e[e.Unknown=6]="Unknown",e))(o||{}),T=(e=>(e[e.AddList=1]="AddList",e[e.StartCombat=2]="StartCombat",e[e.EndCombat=3]="EndCombat",e[e.UpdateDuration=4]="UpdateDuration",e[e.ChangePlayer=5]="ChangePlayer",e[e.PartyChange=6]="PartyChange",e[e.ChangeZone=7]="ChangeZone",e[e.MoveDataToHistoricalData=8]="MoveDataToHistoricalData",e[e.SetActiveHistoricalData=9]="SetActiveHistoricalData",e[e.UpdateRSVData=10]="UpdateRSVData",e))(T||{});const B={},Pe=(e,t)=>{const a=`${e}_${t}`;if(a in B)return B[a];const n=Number.parseInt(e,16).toString();let s=le(n);t&&t>1&&t<=16&&(s+=t-1);const i=b(String(s));return B[a]=i,i},D=e=>`https://xivapi.com/i/${e}`,O=e=>`https://cafemaker.wakingsands.com/i/${e}`,b=e=>{e.length>=6?e=e.padStart(5,"0"):e="0"+e.padStart(5,"0");let t;return e.length>=6?t=e[0]+e[1]+e[2]+"000":t="0"+e[1]+e[2]+"000",`${t}/${e}.png`},ke={[o.Physics]:{url:O(b("060011")),fallbackUrl:D(b("060011"))},[o.Magic]:{url:O(b("060012")),fallbackUrl:D(b("060012"))},[o.Darkness]:{url:O(b("060013")),fallbackUrl:D(b("060013"))},[o.Death]:{url:O(b("060013")),fallbackUrl:D(b("060013"))},[o.Dodge]:{url:"",fallbackUrl:""},[o.Unknown]:{url:"",fallbackUrl:""}},Me=e=>m.Ability.type===e.line[0]||m.NetworkAOEAbility.type===e.line[0],_e=e=>m.NetworkDoT.type===e.line[0],we=e=>m.GainsEffect.type===e.line[0],De=e=>m.LosesEffect.type===e.line[0],Oe=e=>m.WasDefeated.type===e.line[0],xe="40000010",Ne="4000000F",Ve="40000003",ze="40000002",He=e=>{const t=e.line[m.ActorControl.fields.command];return m.ActorControl.type===e.line[0]&&(t===Ne||t===xe)},Ee=e=>{const t=e.line[m.ActorControl.fields.command];return m.ActorControl.type===e.line[0]&&(t===Ve||t===ze)},Se=e=>m.RSVData.type===e.line[0],Xe=new RegExp(/33$|^3$/),Re=new RegExp(new RegExp("(?<!5...)[356]$")),Le=new RegExp(/5.{3}[356]$/),Ue=new RegExp(/6.{3}[356]$/),We="01",Q="05",ee="06",Be=(e,t)=>t==="01"?o.Dodge:Xe.test(e)?o.Death:Re.test(e)?o.Physics:Le.test(e)?o.Magic:Ue.test(e)?o.Darkness:o.Unknown,$e={physics:20,magic:20},je={physics:15,magic:0},qe=e=>Number.isInteger(e)?e.toString():e.toFixed(2),Ge=e=>{const{damageType:t,effects:a,lowByte:n,state:s}=e,i=t===o.Physics,l=t===o.Magic,p=n===Q,y=n===ee;if(!i&&!l)return 0;const d=[...a.map(r=>{try{const c=S[r.effectId];if(r.mutation)return r.mutation;if(c!=null&&c.getMutation){const f=c.getMutation(r,s);return r.mutation=f,f}else if(c!=null&&c.mutation)return c.mutation;return{physics:0,magic:0}}catch{return console.error(">>>> unknow effect",r),{physics:0,magic:0}}}),...p?[$e]:[],...y?[je]:[]].map(r=>i?r.physics:l?r.magic:0).filter(r=>r);return qe((1-d.reduce((r,c)=>(r*=1-c/100,r),1))*100).replace(".00","")??0},Je=(e,t)=>{const a=S[t.effectId];if(!a)return!0;let n=1;switch(e){case o.Physics:n=a.physics;break;case o.Magic:n=a.magic;break;case o.Darkness:n=a.darkness;break;case o.Dodge:n=a.dodge;break;default:n=1;break}return n>0},te=e=>e.startsWith("1"),ae=e=>e.startsWith("4");let ne="Chinese";(async()=>{var t;const e=await K({call:"cactbotLoadUser",source:location.href,overlayName:"raidboss"});(t=e==null?void 0:e.detail)!=null&&t.gameRegion&&(ne=e.detail.gameRegion)})();const _=new Set,Ze=1e3,Ke="_rsv_",v=e=>_.has(e)?!1:(_.add(e),!0),P=()=>{_.size>Ze&&_.clear()},Z=(e,t)=>{const a=e.dataObjectMap.get(t);return(a==null?void 0:a.effectMap.values())??[]},Ye=e=>e.filter(t=>S.hasOwnProperty(t.effectId)?!0:!!/(受伤|耐性|防御力)(提升|(大幅)?降低|低下|加重|减轻)|体力(增加|减少|衰减)/.test(t.effect)),Qe=e=>e.filter(t=>S.hasOwnProperty(t.effectId)),et=(e,t,a)=>{const n=a.line[a.line.length-1],[s,i,l,p,y,u,d,C]=a.line;if(!ae(l)||!te(d))return;const r=Te(a.line),{amount:c,lowByte:f,flags:V,isHeal:z,isAttack:w}=r;if(w){const I=Be(V,f),M=ke[I],H=Z(e,C),X=Z(e,p),E=[...Ye([...H]),...Qe([...X])],R=new Date(i).getTime(),se=E.map(g=>{const oe=Je(I,g);let U=Math.max(Math.ceil((g.expiration-R)/1e3),0).toString();return Number.parseInt(U)>9e3&&(U="∞"),{duration:U,source:g.source,sourceId:g.sourceId,effectId:g.effectId,effect:g.effect,url:g.url,fallbackUrl:g.fallbackUrl,isUsefull:oe}}),ie=Ge({damageType:I,effects:E,lowByte:f,state:e});let L=u;if(u.startsWith(Ke)||ne!=="Chinese"){const g=Number.parseInt(y,16);g in G?L=G[g]:u in e.rsvData&&(L=e.rsvData[u])}const re={key:n,ability:L,targetId:d,target:C,targetName:C,damage:c,damageType:I,damageIcon:M,mutation:ie,duration:"00:00",effects:se,type:N.Ability,source:p,sourceId:l,isBlock:f===Q,isParried:f===ee,isDodge:f===We};t({type:T.AddList,payload:re})}P()},tt=(e,t)=>{const[a,n,s,i,l,p,y,u,d,C]=t.line,r=Pe(s,Number.parseInt(C)),c=O(r),f=D(r),V=Number.parseInt(s,16).toString(),z=ce(V),w={expiration:new Date(n).getTime()+Number.parseFloat(l)*1e3,effectId:s,effect:z||i,sourceId:p,source:y,targetId:u,target:d,count:C,url:c,fallbackUrl:f};let I=e.dataObjectMap.get(d);if(I)I.effectMap.set(s,w);else{const M=new Map;M.set(s,w),I={id:u,name:d,effectMap:M},e.dataObjectMap.set(d,I)}P()},at=(e,t)=>{const[a,n,s,i,l,p,y,u,d,C]=t.line;let r=e.dataObjectMap.get(d);r&&r.effectMap.delete(s),P()},nt=(e,t,a)=>{const[n,s,i,l,p,y,u,d,C,r,c,f,V,z,w,I,M,H,X]=a.line,E=a.line[a.line.length-1];if(!(!ae(H)||!te(i))){if(p==="DoT"){const R={key:E,type:N.DoT,targetId:i,targetName:l,source:X,sourceId:H,damage:Number.parseInt(u,16)};t({type:T.AddList,payload:R})}P()}},st=(e,t,a)=>{const[n,s,i,l,p,y]=a.line,d={key:a.line[a.line.length-1],type:N.Defeated,targetId:i,target:l,sourceId:p,source:y};t({type:T.AddList,payload:d}),P()},it=(e,t,a)=>{const s={key:a.line[a.line.length-1],ability:"✋ 团灭",type:N.Wipe};t({type:T.AddList,payload:s}),setTimeout(()=>{_.clear(),t({type:T.MoveDataToHistoricalData})},2*1e3),P()},rt=(e,t,a)=>{setTimeout(()=>{_.clear(),t({type:T.MoveDataToHistoricalData})},.3*1e3),P()},ot=(e,t,a)=>{const[n,s,i,l,p,y]=a.line;a.line[a.line.length-1],t({type:T.UpdateRSVData,key:p,value:y}),P()},yt=(e,t,a)=>({onLogLine:s=>{const i=s.line[s.line.length-1];Me(s)&&v(i)?et(t,a,s):we(s)&&v(i)?tt(t,s):De(s)&&v(i)?at(t,s):e.showDotDamage&&_e(s)&&v(i)?nt(t,a,s):Oe(s)&&v(i)?st(t,a,s):He(s)&&v(i)?it(t,a,s):Ee(s)&&v(i)?rt(t,a):Se(s)&&v(i)&&ot(t,a,s)}});export{o as D,N as L,T as S,Y as T,q as Y,b as a,O as b,D as c,mt as d,ne as e,pt as f,Z as g,ue as h,ut as l,me as r,yt as u};
